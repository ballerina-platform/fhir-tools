// Copyright (c) 2023, WSO2 LLC. (http://www.wso2.com).

// WSO2 LLC. licenses this file to you under the Apache License,
// Version 2.0 (the "License"); you may not use this file except
// in compliance with the License.
// You may obtain a copy of the License at

// http://www.apache.org/licenses/LICENSE-2.0

// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.

// AUTO-GENERATED FILE.
// This file is auto-generated by Ballerina.

#foreach($import in $imports)
#if($import)
import $import.toString();
#end
#end

public const string PROFILE_BASE_${util.resolveSpecialCharacters($resourceName.toUpperCase())} = "${profile}";
#if(!$isBasePackage)
public const RESOURCE_NAME_${util.resolveSpecialCharacters($resourceName.toUpperCase())} = "${baseType}";
#else
public const RESOURCE_NAME_${util.resolveSpecialCharacters($resourceName.toUpperCase())} = "${resourceType}";
#end

# FHIR $resourceName resource record.
#
# + resourceType - The type of the resource describes
#foreach($element in ${annotationElements})
# + $util.resolveSpecialCharacters($util.resolveKeywordConflict($element.getName())) - $element.getDescription()
#end
@${importIdentifier}ResourceDefinition {
    resourceType: "${resourceType}",
    baseType: ${importIdentifier}DomainResource,
    profile: "${profile}",
    elements: {
    #foreach($element in ${annotationElements})
    "${element.getName()}" : {
            name: "${element.getName()}",
            dataType: #if(!$dataTypes.contains($element.getDataType()))${importIdentifier}${element.getDataType()}#else${element.getDataType()}#end,
            min: ${element.getMin()},
            max: ${element.getMax()},
            isArray: ${element.isArray()},
    #if($element.getValueSet())
        path: "${element.getPath()}",
            valueSet: "${element.getValueSet()}"
    #else
        path: "${element.getPath()}"
    #end
    }#if ($foreach.count != $annotationElements.size()),#end

    #end
},
    serializers: {
        'xml: ${importIdentifier}fhirResourceXMLSerializer,
        'json: ${importIdentifier}fhirResourceJsonSerializer
    }
}
public type $util.resolveSpecialCharacters($resourceName) record {|
    *${importIdentifier}DomainResource;

    RESOURCE_NAME_${util.resolveSpecialCharacters($resourceName.toUpperCase())} resourceType = RESOURCE_NAME_${util.resolveSpecialCharacters($resourceName.toUpperCase())};

    Base${util.resolveSpecialCharacters($resourceName)}Meta meta = {
        profile : [PROFILE_BASE_${util.resolveSpecialCharacters($resourceName.toUpperCase())}]
    };
#foreach($element in $resourceElements)
#if($element.getDataType() != "Meta")
#set($min = "1")
#set($max = "*")
#if( ($element.min == $min ) && ($element.max == $max ) )
    @constraint:Array {
       minLength: 1
    }
#end
    #if(!$dataTypes.contains($element.getDataType()))${importIdentifier}#end${element.getDataType()}#if($element.isArray())[]#end $util.resolveSpecialCharacters($util.resolveKeywordConflict($element.getName()))#if(!$element.isRequired())?#end;
#end
#end
    never...;
|};

@${importIdentifier}DataTypeDefinition {
    name: "Base${resourceType}Meta",
    baseType: ${importIdentifier}Meta,
    elements: {},
    serializers: {
        'xml: ${importIdentifier}complexDataTypeXMLSerializer,
        'json: ${importIdentifier}complexDataTypeJsonSerializer
    }
}
public type Base${util.resolveSpecialCharacters($resourceName)}Meta record {|
    *${importIdentifier}Meta;

    //Inherited child element from "Element" (Redefining to maintain order when serialize) (START)
    string id?;
    ${importIdentifier}Extension[] extension?;
    //Inherited child element from "Element" (Redefining to maintain order when serialize) (END)

    ${importIdentifier}id versionId?;
    ${importIdentifier}instant lastUpdated?;
    ${importIdentifier}uri 'source?;
    ${importIdentifier}canonical[] profile = ["${profile}"];
    ${importIdentifier}Coding[] security?;
    ${importIdentifier}Coding[] tag?;
|};

#foreach($extendedElement in $extendedElements)
#if($extendedElement.getBalDataType().getType() == "record")
# FHIR $extendedElement.getTypeName() datatype record.
#
#foreach($annotationElement in $extendedElement.getAnnotation().getElements())
# + $util.resolveSpecialCharacters($util.resolveKeywordConflict($annotationElement.getName())) - $annotationElement.getDescription()
#end
@${importIdentifier}DataTypeDefinition {
    name: "${extendedElement.getTypeName()}",
    baseType: $extendedElement.getAnnotation().getBaseType(),
    elements: {
    #foreach($annotationElement in $extendedElement.getAnnotation().getElements())
    "${annotationElement.getName()}": {
            name: "${annotationElement.getName()}",
            dataType: #if(!$dataTypes.contains($annotationElement.getDataType()))${importIdentifier}${annotationElement.getDataType()}#else${annotationElement.getDataType()}#end,
            min: $annotationElement.getMin(),
            max: $annotationElement.getMax(),
            isArray: $annotationElement.isArray(),
            description: "$annotationElement.getDescription()",
    #if($element.getValueSet())
        path: "${annotationElement.getPath()}",
        valueSet: "${annotationElement.getValueSet()}"
    #else
        path: "${annotationElement.getPath()}"
    #end
    }#if ($foreach.count != $extendedElement.getAnnotation().getElements().size()),#end

    #end
},
    serializers: {
        'xml: ${importIdentifier}complexDataTypeXMLSerializer,
        'json: ${importIdentifier}complexDataTypeJsonSerializer
    }
}
public type $util.resolveSpecialCharacters($extendedElement.getTypeName()) record {|
#foreach($childElement in $extendedElement.getElements())
#set($min = "1")
#set($max = "*")
#if( ($childElement.min == $min ) && ($childElement.max == $max ) )
    @constraint:Array {
       minLength: 1
    }
#end
    #if(!$dataTypes.contains($childElement.getDataType()))${importIdentifier}#end${childElement.getDataType()}#if($childElement.isArray())[]#end $util.resolveSpecialCharacters($util.resolveKeywordConflict($childElement.getName()))#if(!$childElement.isRequired())?#end;
#end
|};
#elseif($extendedElement.getBalDataType().getType() == "enum")
# $extendedElement.getTypeName() enum
public enum $util.resolveSpecialCharacters($extendedElement.getTypeName()) {
#foreach($childElement in $extendedElement.getElements())
   CODE_$childElement.getRootElementName().toUpperCase()_$util.resolveSpecialCharacters($childElement.getName()).toUpperCase() = "$childElement.getName()"#if($foreach.count != $extendedElement.getElements().size()),$newline#end
#end

}
#end

#end
